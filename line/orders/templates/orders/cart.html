{% extends 'users/base.html' %}
{% load cart_tags %}
{% load static %}

{% block content %}

<div class="col-sm-12 col-md-12 col-lg-9 pb-4">
    {% if products_all%}
    <h3 class="text-center mt-5 mb-5">Cart</h3>
    {% else %}
    <h3 class="text-center mt-5 mb-5">Your cart is empty</h3>
    {% endif %}
        <br>
        <div class="row">
            {% for product_in_cart in products_all|dictsort:"pk" %}
                <div class="col-sm-12 col-md-6 col-lg-4 pb-4">
                    <div class="h-100">

                        <a href="{{ product_in_cart.product.get_absolute_url }}">
                            <img src="{{ product_in_cart.product.product_file.filter.first.image.url }}" class="card-img-top" alt="{{ product_in_cart.product.title }}" style="width: auto; height: 225px; object-fit: scale-down;">
                        </a>
                        <div class="card-body">
                            <h5 class="card-title">{{ product_in_cart.product.title }}</h5>
                             <p class="card-text text-muted" style="font-size:12px">{{product_in_cart.quantity}} ✕ {% total_quantity product_in_cart.product.price product_in_cart.quantity%} RUB </p>
                            <div class="input-group quantity_goods">
                                {% if product_in_cart.quantity > 1 %}
                                <form action="{% url 'orders:diminish_product' product_id=product_in_cart.product.id%}" method="POST">
                                {% csrf_token%}
                                <button type="submit" class="btn btn-dark diminish_product"> - </button>
                                </form>
                                {% endif %}

                                <p data-product-quantity="{{ product_in_cart.product.id }}" class="card-text text-muted" style="font-size:25px">{{ product_in_cart.quantity}}</p>

                                <input type="hidden" id="url_increase_product" data-url="{% url 'orders:increase_product' %}" />
                                <button data-increase-product="{{ product_in_cart.product.id }}" type="submit" class="btn btn-dark increase_product"> + </button>
                            </div>

                            <form action="{% url 'orders:delete_product' product_id=product_in_cart.product.id %}" method="POST">
                                {% csrf_token %}
                                <button class="btn btn-primary">Delete</button>
                            </form>
                        </div>

                    </div>
                </div>
            {% endfor %}

            {% if products_all %}
            <table class="table__cart">
              <tbody>
                    <tr>
                      <td colspan="2"></td>
                      <td >Total:</td>
                      <td>{{ total_count_product }}</td>
                      <td><strong>{{ total_price_product }} руб.</strong></td>
                    </tr>
              </tbody>
            </table>
            <form action="{% url 'orders:checkout' %}" method="POST">
                {% csrf_token %}
                <button class="btn btn-primary">Proceed to Checkout</button>
            </form>
            {% endif %}
        </div>
</div>

{% endblock %}
